'use strict'
angular.module('app.auth', ['app.services'])

.controller('AuthCtrl', ['$scope', '$state', '$window', 'Auth', 'Profile',function($scope, $state, $window, Auth, Profile){
  $scope.signin = function () {
    Auth.signin($scope.user)
      .then(function (token) {
        if (token) {
          $window.localStorage.setItem('com.app', token);
          $state.go('dashboard');
        }
        else {
          $state.go('main.buttons');
        }
      })
      .catch(function (error) {
        console.error(error);
      });
  };
  $scope.advanceToFoodPrefs = function() {
    $state.go('main.createprofile', {user:$scope.user})
  }
  $scope.signup = function () {
    Process.profile($scope.user)
      .then(function (token) {

        $window.localStorage.setItem('com.app', token);

        $state.go('main.createprofile');
      })
      .catch(function (error) {
        console.error(error);
      });
  };
}])

'use strict'
angular.module('app.createevent', [])

.controller('CreateEventCtrl', ['$scope', function($scope){}]);

'use strict';
angular.module('app.createprofile', ['app.services'])

.controller('CreateProfileCtrl', ['$scope', '$state', '$stateParams','Auth', 'Profile', function($scope, $state, $stateParams, Auth, Profile) {

  $scope.user = $stateParams.user;

  $scope.activate = function(formData) {
    angular.extend($scope.user,formData);
    var profile = Profile.processData($scope.user);
    Auth.signup(profile);
    Auth.userData = $scope.user;
    $state.go('dashboard.createevent');
  };

}])

'use strict'
angular.module('app.dashboard', ['app.services'])

.controller('DashboardCtrl', ['$scope', '$state', 'Auth', function($scope, $state, Auth){
  $scope.signout = function () {
    Auth.signout();
    // $state.go('main.buttons');
  }
}]);

'use strict';
angular.module('app.editprofile', ['app.services'])

.controller('EditProfileCtrl', ['$state','$scope', 'Profile', 'Auth', function($state, $scope, Profile, Auth) {

  $scope.user = Auth.userData;
  console.log($scope.user)

  $scope.activate = function(formdata) {
    Profile.processData(formdata);
    $state.go('dashboard.createevent')
  }
}])

angular.module('app.main', ['app.services'])

.controller('MainCtrl', ['$scope', '$state', 'Auth', function($scope, $state, Auth){

}]);

'use strict'
angular.module('app.optionform', ['app.services'])

.controller('OptionformCtrl', ['$scope', '$location', '$state', 'userFactory', 'restaurantFactory', function($scope, $location, $state, userFactory, restaurantFactory){
  $scope.search = function(data) {
    var foodtype;
    for (var key in data) {
      if (typeof data[key] === 'boolean') {
        foodtype = key;
      }
    }
    var searchParams = {
      opt1:foodtype,
      location:data.location
    }
    $state.go('loading');
    userFactory.userReq(searchParams)
    .then(function(res){
      restaurantFactory.restaurants = res.data.slice(0, 11);
      console.log("inside restaurantFactory ",restaurantFactory.restaurants);
      $state.go('dashboard.restaurantResults');
  })
};
  $scope.getUserReq = function() {
    $state.go('dashboard.loading');

    userFactory.userReq($scope.user).then(function(res){
      restaurantFactory.restaurants = res.data.slice(0, 11);
      console.log(restaurantFactory.restaurants);
      $state.go('dashboard.restaurantResults');
    });
  }
}]);


angular.module('app.restaurantresults', [])

.controller('RestaurantResultsCtrl', ['$scope', 'restaurantFactory', function($scope, restaurantFactory) {
  $scope.data = {
    restaurants: restaurantFactory.restaurants
  }
  

  $scope.logger = function() {
    console.log('hit');
  }

}]);

angular.module('app.showevent', [])

.controller('ShowEventCtrl', ['$scope', function($scope){}]);
